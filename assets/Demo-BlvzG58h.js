import{_ as fe}from"./index-BVHpXY-2.js";import{d as ve,r as f,b as ge,v as c,x as s,y as T,L as he,C as w,P as D,Q as K,R as yt,O as g,G as U,F as E,z as L,S as bt,M as ye,U as be,E as p}from"./vendor-D0BmMjoO.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"gaznetcad-app"},we={class:"app-header"},Se={class:"header-center"},Ce={class:"toolbar"},ke={class:"header-right"},Ae=["disabled"],Me={class:"workspace"},$e={class:"sidebar left-sidebar"},Ee={class:"sidebar-section"},Re={class:"param-group"},Oe={class:"param-group"},Ne={class:"param-group"},Le={class:"sidebar-section"},ze={key:0,class:"element-props"},Ve={class:"prop-group"},Ie={class:"prop-group"},Pe={class:"prop-group"},Te={class:"prop-group"},De={class:"prop-group"},Ue={key:1,class:"no-selection"},qe={class:"sidebar-section"},Fe={class:"calc-results"},Ge={class:"result-item"},Be={class:"result-item"},We={class:"result-item"},Xe={class:"result-item"},Ye={class:"canvas-area"},je={class:"canvas-toolbar"},Je={class:"view-controls"},He={class:"zoom-controls"},Qe={class:"tool-indicator"},Ke={class:"obstacle-label"},Ze=["onMousedown"],_e={key:0,class:"pipe"},tn=["onClick"],en={class:"measurement-label"},nn={class:"sidebar right-sidebar"},sn={class:"tabs"},on={key:0,class:"tab-content"},ln={class:"logs-container"},rn={class:"log-time"},an={key:1,class:"tab-content"},un={class:"table-container"},dn={key:2,class:"tab-content"},cn={class:"table-container"},pn={key:3,class:"tab-content"},fn={class:"table-container"},vn=["onUpdate:modelValue"],gn={key:0,class:"modal-overlay"},hn={class:"modal"},yn={class:"modal-content"},bn={class:"obstacle-types"},mn={key:1,class:"modal-overlay"},xn={class:"modal"},wn=ve({__name:"Demo",setup(Sn){const y=f("select"),B=f("2d"),R=f(1),S=f(null),A=f("console"),W=f({x:0,y:0}),O=f({pressure:.3,temperature:20,gasType:"natural"}),N=f([{id:1,name:"Труба-1",type:"pipe",x:100,y:100,length:50,diameter:110,material:"pe",roughness:.01,flowRate:150,pressureLoss:.002,velocity:0,reynolds:0,connections:[]},{id:2,name:"Клапан-1",type:"valve",x:200,y:100,diameter:110,material:"steel",isOpen:!0,velocity:0,reynolds:0,connections:[]},{id:3,name:"Труба-2",type:"pipe",x:300,y:100,length:75,diameter:110,material:"pe",roughness:.01,flowRate:150,pressureLoss:.003,velocity:0,reynolds:0,connections:[]}]),M=f([{id:1,name:"Здание-1",type:"building",x:150,y:80,width:60,height:40,color:"#ff4757",priority:"high"},{id:2,name:"Дерево",type:"tree",x:250,y:120,radius:15,color:"#2ed573",priority:"medium"},{id:3,name:"Подземная труба",type:"underground",x:180,y:150,width:80,height:8,color:"#ffa502",priority:"high"}]),rt=f([{id:1,name:"Трубопроводы",visible:!0,color:"#00d4ff"},{id:2,name:"Арматура",visible:!0,color:"#ff6b6b"},{id:3,name:"Измерения",visible:!0,color:"#00ff88"},{id:4,name:"Соединения",visible:!0,color:"#ffd43b"}]),at=f([{id:1,position:"1",name:"Труба ПЭ 110x10",quantity:125,unit:"м"},{id:2,position:"2",name:"Клапан запорный 110",quantity:1,unit:"шт"},{id:3,position:"3",name:"Муфта 110",quantity:2,unit:"шт"}]),I=f({flowRate:0,velocity:0,pressureLoss:0,reynolds:0}),nt=f([{id:1,name:"Участок 1",length:50,diameter:110,flowRate:150,pressureLoss:.002},{id:2,name:"Участок 2",length:75,diameter:110,flowRate:150,pressureLoss:.003}]),j=f([{id:1,time:"14:30:15",message:"Проект загружен",type:"info"},{id:2,time:"14:30:20",message:"Расчёт выполнен успешно",type:"success"}]);f([{id:1,time:"14:30:15",message:"Инициализация системы"},{id:2,time:"14:30:16",message:"Загрузка библиотек"}]),f([]);const Z=f(!1),mt=f({x:0,y:0}),z=f(null),q=f([]),X=f([]),st=f(!1),J=f(null),ot=f({x:0,y:0}),F=f([]),_=f([]),ut=f(!1),tt=f(!1);function xt(){R.value=Math.min(R.value+.1,2)}function wt(){R.value=Math.max(R.value-.1,.2)}const St={pulse:{animation:"pulse 2s infinite"},flow:{animation:"flow 3s infinite"},glow:{animation:"glow 1.5s ease-in-out infinite alternate"},bounce:{animation:"bounce 1s infinite"}};function dt(e,t){e.animationClass=t,e.animationStyle=St[t]||{},setTimeout(()=>{e.animationClass=null,e.animationStyle={}},3e3)}function Ct(e){S.value=e,dt(e,"glow"),b("info",`Выбран элемент: ${e.name}`)}function kt(e){e.type==="valve"&&(e.isOpen=!e.isOpen,dt(e,e.isOpen?"glow":"pulse"),b("info",`Клапан ${e.name} ${e.isOpen?"открыт":"закрыт"}`),Q())}function it(e){tt.value=!1,At(e,W.value.x,W.value.y)}function At(e,t,n){const o=Date.now();let i={id:o,name:"",type:e,x:t,y:n,priority:"medium"};e==="building"?(i.name=`Здание-${o}`,i.width=60,i.height=40,i.color="#ff4757",i.priority="high"):e==="tree"?(i.name="Дерево",i.radius=15,i.color="#2ed573"):e==="underground"&&(i.name="Подземная труба",i.width=80,i.height=8,i.color="#ffa502",i.priority="high"),M.value.push(i),H()}function Mt(e){const t=e.target.getBoundingClientRect(),n=(e.clientX-t.left)/R.value,o=(e.clientY-t.top)/R.value;W.value={x:Math.round(n),y:Math.round(o)},y.value==="line"?It(n,o):y.value==="pipe"?Rt(n,o):y.value==="valve"?Ot(n,o):y.value==="measure"?Pt(n,o):y.value==="obstacle"?tt.value=!0:y.value==="select"&&Nt(n,o)}function $t(e){const t=e.target.getBoundingClientRect(),n=(e.clientX-t.left)/R.value,o=(e.clientY-t.top)/R.value;if(W.value={x:Math.round(n),y:Math.round(o)},Z.value&&z.value&&(z.value.end={x:Math.round(n),y:Math.round(o)}),st.value&&J.value){const i=n-ot.value.x,l=o-ot.value.y;J.value.x=Math.round(i),J.value.y=Math.round(l),H()}}function Et(e){if(Z.value&&z.value){const t={id:Date.now().toString(),start:z.value.start,end:z.value.end,segments:[],waypoints:[],hasCollision:!1,isFlowing:!1};if(M.value.some(o=>et(t.start,t.end,o))){const o=pt(t.start,t.end,M.value);t.segments=gt(t.start,t.end,o.slice(1,-1)),t.waypoints=o.slice(1,-1)}else t.segments=gt(t.start,t.end);q.value.push(t),H(),b("success","Соединение создано")}Z.value=!1,st.value=!1,z.value=null,J.value=null}function Rt(e,t){const n=Date.now();N.value.push({id:n,name:`Труба-${n}`,type:"pipe",x:e,y:t,length:50,diameter:110,material:"pe",roughness:.01,flowRate:100,pressureLoss:.001,velocity:0,reynolds:0,connections:[]})}function Ot(e,t){const n=Date.now();N.value.push({id:n,name:`Клапан-${n}`,type:"valve",x:e,y:t,diameter:110,material:"steel",isOpen:!0,velocity:0,reynolds:0,connections:[]})}function Nt(e,t){const n=Lt(e,t);n&&(st.value=!0,J.value=n,ot.value={x:e-n.x,y:t-n.y},S.value=n,b("info",`Перемещение элемента: ${n.name}`))}function Lt(e,t){for(const n of N.value){const o=zt(n);if(e>=o.left&&e<=o.right&&t>=o.top&&t<=o.bottom)return n}for(const n of M.value){const o=Vt(n);if(e>=o.left&&e<=o.right&&t>=o.top&&t<=o.bottom)return n}return null}function zt(e){return e.type==="pipe"?{left:e.x,top:e.y,right:e.x+100,bottom:e.y+20}:e.type==="valve"?{left:e.x-15,top:e.y-15,right:e.x+15,bottom:e.y+15}:{left:0,top:0,right:0,bottom:0}}function Vt(e){return e.type==="building"?{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}:e.type==="tree"?{left:e.x-e.radius,top:e.y-e.radius,right:e.x+e.radius,bottom:e.y+e.radius}:e.type==="underground"?{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height}:{left:0,top:0,right:0,bottom:0}}function It(e,t){Z.value=!0,mt.value={x:e,y:t},z.value={start:{x:e,y:t},end:{x:e,y:t}}}function Pt(e,t){const o={id:Date.now(),start:{x:e,y:t},end:{x:e,y:t},value:0};X.value.push(o)}function et(e,t,n){const{x:o,y:i}=e,{x:l,y:r}=t;return n.type==="building"?ct(o,i,l,r,n.x,n.y,n.width,n.height):n.type==="tree"?Tt(o,i,l,r,n.x,n.y,n.radius):n.type==="underground"?ct(o,i,l,r,n.x,n.y,n.width,n.height):!1}function ct(e,t,n,o,i,l,r,a){const d=i,u=i+r,h=l,v=l+a;if(e>=d&&e<=u&&t>=h&&t<=v||n>=d&&n<=u&&o>=h&&o<=v)return!0;const C=[{x1:d,y1:h,x2:u,y2:h},{x1:u,y1:h,x2:u,y2:v},{x1:u,y1:v,x2:d,y2:v},{x1:d,y1:v,x2:d,y2:h}];for(const m of C)if(Dt(e,t,n,o,m.x1,m.y1,m.x2,m.y2))return!0;return!1}function Tt(e,t,n,o,i,l,r){const a=n-e,d=o-t,u=i-e,h=l-t,v=a*u+d*h,C=a*a+d*d;if(C===0)return!1;const m=v/C;let x,k;m<0?(x=e,k=t):m>1?(x=n,k=o):(x=e+m*a,k=t+m*d);const V=i-x,$=l-k;return Math.sqrt(V*V+$*$)<=r}function Dt(e,t,n,o,i,l,r,a){const d=(a-l)*(n-e)-(r-i)*(o-t);if(d===0)return!1;const u=((r-i)*(t-l)-(a-l)*(e-i))/d,h=((n-e)*(t-l)-(o-t)*(e-i))/d;return u>=0&&u<=1&&h>=0&&h<=1}function pt(e,t,n){const o=[e];let i={...e};const l=[...n].sort((r,a)=>{const d={high:3,medium:2,low:1};return d[a.priority]-d[r.priority]});for(const r of l)if(et(i,t,r)){const a=Ut(i,t,r);a&&(o.push(a),i=a)}return o.push(t),o}function Ut(e,t,n){const{x:o,y:i}=e,{x:l,y:r}=t;return n.type==="building"?qt(o,i,l,r,n):n.type==="tree"?Ft(o,i,l,r,n):n.type==="underground"?Gt(o,i,l,r,n):null}function qt(e,t,n,o,i){const{x:l,y:r,width:a,height:d}=i,u=50,h=[{x:l,y:r},{x:l+a,y:r},{x:l+a,y:r+d},{x:l,y:r+d}];let v=h[0],C=1/0;for(const P of h){const Y=Math.sqrt((P.x-e)**2+(P.y-t)**2);Y<C&&(C=Y,v=P)}const m=l+a/2,x=r+d/2;if(t<x&&o<x)return{x:Math.round(m),y:Math.round(r-u-20)};if(t>x&&o>x)return{x:Math.round(m),y:Math.round(r+d+u+20)};if(e<m&&n<m)return{x:Math.round(l-u-20),y:Math.round(x)};if(e>m&&n>m)return{x:Math.round(l+a+u+20),y:Math.round(x)};const k=v.x-e,V=v.y-t,$=Math.sqrt(k*k+V*V);if($>0){const P=v.x+k/$*(u+30),Y=v.y+V/$*(u+30);return{x:Math.round(P),y:Math.round(Y)}}return{x:v.x+u+30,y:v.y+u+30}}function Ft(e,t,n,o,i){const{x:l,y:r,radius:a}=i,d=35,u=n-e,h=o-t,v=Math.sqrt(u*u+h*h);if(v===0)return{x:l+a+d,y:r};const C=u/v,m=h/v,x={x:Math.round(l+C*(a+d)),y:Math.round(r+m*(a+d))},k=-m,V=C,$={x:Math.round(x.x+k*(a+15)),y:Math.round(x.y+V*(a+15))},P=Math.sqrt((x.x-e)**2+(x.y-t)**2),Y=Math.sqrt(($.x-e)**2+($.y-t)**2);return P<Y?x:$}function Gt(e,t,n,o,i){const{x:l,y:r,width:a,height:d}=i,u=60,h=r+d/2,v=l+a/2,C=Math.atan2(o-t,n-e)*180/Math.PI;return Math.abs(C)<45||Math.abs(C)>135?t<h?{x:Math.round(v),y:Math.round(r-u-30)}:{x:Math.round(v),y:Math.round(r+d+u+30)}:e<v?{x:Math.round(l-u-30),y:Math.round(h)}:{x:Math.round(l+a+u+30),y:Math.round(h)}}function H(){F.value=[];for(const e of q.value)M.value.some(n=>et(e.start,e.end,n))?(e.hasCollision=!0,F.value.push({id:e.id,message:`Коллизия с препятствием в соединении ${e.id}`,connection:e})):e.hasCollision=!1;F.value.length>0?b("warning",`Обнаружено ${F.value.length} коллизий`):b("success","Коллизий не обнаружено")}function Bt(){if(F.value.length===0){b("info","Нет коллизий для обхода");return}ut.value=!0,b("info","Начинаем автоматический обход препятствий..."),_.value=[];for(const e of F.value){const t=e.connection,n=pt(t.start,t.end,M.value);t.segments=[];for(let o=0;o<n.length-1;o++){const i={start:n[o],end:n[o+1],isWaypoint:o>0&&o<n.length-2};t.segments.push(i)}_.value.push({id:`reroute-${t.id}`,waypoints:n,connectionId:t.id})}Q(),ut.value=!1,b("success",`Автоматический обход завершён. Создано ${_.value.length} путей обхода`)}function b(e,t){const n=new Date().toLocaleTimeString(),o=Date.now();j.value.unshift({id:o,time:n,message:t,type:e}),j.value.length>50&&(j.value=j.value.slice(0,50))}function Wt(e){const t={position:"absolute",border:"2px solid",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease",zIndex:10};if(e.type==="building"){const n={...t,left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,backgroundColor:"rgba(255, 71, 87, 0.2)",borderColor:"#ff4757",boxShadow:"0 0 15px rgba(255, 71, 87, 0.3)"};return e.priority==="high"?{...n,borderWidth:"3px",...lt("#ff4757",1.5)}:n}else if(e.type==="tree"){const n={...t,left:`${e.x-e.radius}px`,top:`${e.y-e.radius}px`,width:`${e.radius*2}px`,height:`${e.radius*2}px`,backgroundColor:"rgba(46, 213, 115, 0.2)",borderColor:"#2ed573",borderRadius:"50%",boxShadow:"0 0 15px rgba(46, 213, 115, 0.3)"};return e.priority==="high"?{...n,borderWidth:"3px",...lt("#2ed573",1.5)}:n}else if(e.type==="underground"){const n={...t,left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,backgroundColor:"rgba(255, 165, 2, 0.2)",borderColor:"#ffa502",boxShadow:"0 0 15px rgba(255, 165, 2, 0.3)"};return e.priority==="high"?{...n,borderWidth:"3px",...lt("#ffa502",1.5)}:n}return t}function Xt(e){if(e.waypoints&&e.waypoints.length>2)return{position:"absolute",pointerEvents:"none",zIndex:5};const t={position:"absolute",height:"2px",background:"linear-gradient(90deg, #00d4ff 0%, #0099cc 100%)",boxShadow:"0 0 10px rgba(0, 212, 255, 0.5)",pointerEvents:"none",transition:"all 0.3s ease",zIndex:15};return e.hasCollision?{...t,background:"linear-gradient(90deg, #ff4757 0%, #ff6b6b 100%)",boxShadow:"0 0 20px rgba(255, 71, 87, 0.8)",zIndex:25}:e.isFlowing?{...t,background:"linear-gradient(90deg, #00ff88 0%, #00cc6a 100%)",boxShadow:"0 0 15px rgba(0, 255, 136, 0.6)",zIndex:20}:t}function Yt(e){if(!e)return{};const t=e.end.x-e.start.x,n=e.end.y-e.start.y,o=Math.sqrt(t*t+n*n),i=Math.atan2(n,t)*180/Math.PI;return{left:`${e.start.x}px`,top:`${e.start.y}px`,width:`${o}px`,transform:`rotate(${i}deg)`,transformOrigin:"0 50%"}}function jt(e){const t=e.end.x-e.start.x,n=e.end.y-e.start.y,o=Math.sqrt(t*t+n*n),i=Math.atan2(n,t)*180/Math.PI;let l="linear-gradient(90deg, #00ff88 0%, #00cc6a 100%)",r="0 0 10px rgba(0, 255, 136, 0.5)";return e.hasCollision?(l="linear-gradient(90deg, #ff4757 0%, #ff6b6b 100%)",r="0 0 20px rgba(255, 71, 87, 0.8)"):e.isFinal?(l="linear-gradient(90deg, #00d4ff 0%, #0099cc 100%)",r="0 0 10px rgba(0, 212, 255, 0.5)"):e.isWaypoint&&(l="linear-gradient(90deg, #ffd43b 0%, #ffed4e 100%)",r="0 0 15px rgba(255, 212, 59, 0.6)"),{left:`${e.start.x}px`,top:`${e.start.y}px`,width:`${o}px`,height:"3px",transform:`rotate(${i}deg)`,transformOrigin:"0 50%",background:l,boxShadow:r,position:"absolute",pointerEvents:"none",zIndex:e.hasCollision?25:15,transition:"all 0.3s ease"}}function Jt(e){const t={left:`${e.x}px`,top:`${e.y}px`,position:"absolute",cursor:"pointer",transition:"all 0.3s ease",zIndex:15};return e.type==="pipe"?{...t,width:"100px",height:"20px",background:"linear-gradient(90deg, #00d4ff 0%, #0099cc 100%)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"600",color:"#fff",textShadow:"0 1px 2px rgba(0, 0, 0, 0.5)",boxShadow:"0 2px 8px rgba(0, 212, 255, 0.3)"}:e.type==="valve"?{...t,width:"40px",height:"40px",background:e.isOpen?"linear-gradient(135deg, #00ff88 0%, #00cc6a 100%)":"linear-gradient(135deg, #ff4757 0%, #ff6b6b 100%)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",boxShadow:e.isOpen?"0 0 20px rgba(0, 255, 136, 0.5)":"0 0 20px rgba(255, 71, 87, 0.5)",border:"2px solid #fff"}:t}function Ht(e){const t=e.end.x-e.start.x,n=e.end.y-e.start.y,o=Math.sqrt(t*t+n*n),i=Math.atan2(n,t)*180/Math.PI;return e.value=Math.round(o),{left:`${e.start.x}px`,top:`${e.start.y}px`,width:`${o}px`,height:"2px",transform:`rotate(${i}deg)`,transformOrigin:"0 50%",background:"linear-gradient(90deg, #00ff88 0%, #00cc6a 100%)",boxShadow:"0 0 10px rgba(0, 255, 136, 0.5)",position:"absolute",pointerEvents:"none",zIndex:10}}const Qt=e=>({select:"Выбор",line:"Линия",pipe:"Труба",valve:"Клапан",measure:"Измерение",obstacle:"Препятствие"})[e]||e;function Q(){b("info","Начинаем гидравлический расчёт...");let e=0,t=0,n=0,o=0,i=0;for(const l of N.value)if(l.type==="pipe"){const r=Kt(l);l.flowRate=r.flowRate,l.pressureLoss=r.pressureLoss,l.velocity=r.velocity,l.reynolds=r.reynolds,e+=r.flowRate,t+=r.pressureLoss,n+=l.length||0,o=Math.max(o,r.velocity),i=Math.max(i,r.reynolds)}I.value={flowRate:Math.round(e),velocity:Number(o.toFixed(2)),pressureLoss:Number(t.toFixed(4)),reynolds:Math.round(i)},ee(),b("success",`Расчёт завершён. Расход: ${I.value.flowRate} м³/ч`)}function Kt(e){const{diameter:t,length:n,material:o,roughness:i}=e,{pressure:l,temperature:r,gasType:a}=O.value,d=Zt(a,r),u=t/1e3,h=n,v=Math.PI*u*u/4,m=_t(t,l),x=m/3600/v,k=x*u/d.kinematicViscosity,$=te(k,i,u)*h*d.density*x*x/(2*u);return{flowRate:m,velocity:x,pressureLoss:$/1e6,reynolds:k}}function Zt(e,t){const n={natural:{density:.668,kinematicViscosity:15e-6},propane:{density:1.88,kinematicViscosity:12e-7},butane:{density:2.48,kinematicViscosity:11e-7}},o=n[e]||n.natural,i=1+(t-20)*.003;return{density:o.density/i,kinematicViscosity:o.kinematicViscosity}}function _t(e,t){const o={50:50,63:80,90:150,110:250,160:500,200:800,250:1200,315:2e3}[e]||150,i=Math.sqrt(t/.3);return Math.round(o*i)}function te(e,t,n){const o=t/(n*1e3);if(e<2300)return 64/e;{let i=.02;for(let l=0;l<10;l++){const r=1/Math.pow(-2*Math.log10(o/3.7+2.51/(e*Math.sqrt(i))),2);if(Math.abs(r-i)<.001)break;i=r}return i}}function ee(){nt.value=N.value.filter(e=>e.type==="pipe").map((e,t)=>({id:t+1,name:e.name,length:e.length||0,diameter:e.diameter,flowRate:e.flowRate||0,pressureLoss:e.pressureLoss||0}))}function ne(){G.value=!0}function se(){if(!document.querySelector(".canvas")){b("error","Канвас не найден");return}const t=ie(),n=new XMLSerializer().serializeToString(t),o=new Blob([n],{type:"image/svg+xml"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=`gaznetcad-scheme-${new Date().toISOString().split("T")[0]}.svg`,i.click(),b("success","Схема экспортирована в SVG"),G.value=!1}function oe(){const e=document.querySelector(".canvas");if(!e){b("error","Канвас не найден");return}fe(()=>import("./html2canvas.esm-CBrSDip1.js"),[]).then(t=>{t.default(e,{background:"#0a0a0a",useCORS:!0,allowTaint:!0}).then(n=>{n.toBlob(o=>{if(o){const i=document.createElement("a");i.href=URL.createObjectURL(o),i.download=`gaznetcad-scheme-${new Date().toISOString().split("T")[0]}.png`,i.click(),b("success","Схема экспортирована в PNG")}},"image/png")})}).catch(()=>{b("error","Ошибка экспорта PNG. Установите html2canvas")}),G.value=!1}function ie(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","1200"),e.setAttribute("height","800"),e.setAttribute("viewBox","0 0 1200 800"),e.style.backgroundColor="#0a0a0a";const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),n=document.createElementNS("http://www.w3.org/2000/svg","pattern");n.setAttribute("id","grid"),n.setAttribute("width","20"),n.setAttribute("height","20"),n.setAttribute("patternUnits","userSpaceOnUse");const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M 20 0 L 0 0 0 20"),o.setAttribute("fill","none"),o.setAttribute("stroke","rgba(0, 212, 255, 0.1)"),o.setAttribute("stroke-width","1"),n.appendChild(o),t.appendChild(n),e.appendChild(t);const i=document.createElementNS("http://www.w3.org/2000/svg","rect");return i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill","url(#grid)"),e.appendChild(i),M.value.forEach(l=>{const r=le(l);e.appendChild(r)}),q.value.forEach(l=>{re(l).forEach(a=>e.appendChild(a))}),N.value.forEach(l=>{const r=ae(l);e.appendChild(r)}),X.value.forEach(l=>{const r=ue(l);e.appendChild(r)}),e}function le(e){if(e.type==="building"){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",e.x.toString()),t.setAttribute("y",e.y.toString()),t.setAttribute("width",e.width.toString()),t.setAttribute("height",e.height.toString()),t.setAttribute("fill","rgba(255, 71, 87, 0.2)"),t.setAttribute("stroke","#ff4757"),t.setAttribute("stroke-width","2");const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",(e.x+e.width/2).toString()),n.setAttribute("y",(e.y+e.height/2).toString()),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.setAttribute("fill","#ff4757"),n.setAttribute("font-size","10"),n.textContent=e.name;const o=document.createElementNS("http://www.w3.org/2000/svg","g");return o.appendChild(t),o.appendChild(n),o}else if(e.type==="tree"){const t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x.toString()),t.setAttribute("cy",e.y.toString()),t.setAttribute("r",e.radius.toString()),t.setAttribute("fill","rgba(46, 213, 115, 0.2)"),t.setAttribute("stroke","#2ed573"),t.setAttribute("stroke-width","2");const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",e.x.toString()),n.setAttribute("y",(e.y-e.radius-5).toString()),n.setAttribute("text-anchor","middle"),n.setAttribute("fill","#2ed573"),n.setAttribute("font-size","10"),n.textContent=e.name;const o=document.createElementNS("http://www.w3.org/2000/svg","g");return o.appendChild(t),o.appendChild(n),o}return document.createElementNS("http://www.w3.org/2000/svg","g")}function re(e){const t=[];if(e.segments&&e.segments.length>0)e.segments.forEach(n=>{const o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",n.start.x.toString()),o.setAttribute("y1",n.start.y.toString()),o.setAttribute("x2",n.end.x.toString()),o.setAttribute("y2",n.end.y.toString()),o.setAttribute("stroke",n.hasCollision?"#ff4757":"#00d4ff"),o.setAttribute("stroke-width","2"),o.setAttribute("stroke-linecap","round"),t.push(o)});else{const n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1",e.start.x.toString()),n.setAttribute("y1",e.start.y.toString()),n.setAttribute("x2",e.end.x.toString()),n.setAttribute("y2",e.end.y.toString()),n.setAttribute("stroke",e.hasCollision?"#ff4757":"#00d4ff"),n.setAttribute("stroke-width","2"),n.setAttribute("stroke-linecap","round"),t.push(n)}return t}function ae(e){if(e.type==="pipe"){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",e.x.toString()),t.setAttribute("y",e.y.toString()),t.setAttribute("width","100"),t.setAttribute("height","20"),t.setAttribute("rx","10"),t.setAttribute("fill","url(#pipeGradient)"),t.setAttribute("stroke","#00d4ff"),t.setAttribute("stroke-width","2");const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",(e.x+50).toString()),n.setAttribute("y",(e.y+10).toString()),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.setAttribute("fill","#000"),n.setAttribute("font-size","10"),n.textContent=e.name;const o=document.createElementNS("http://www.w3.org/2000/svg","g");return o.appendChild(t),o.appendChild(n),o}else if(e.type==="valve"){const t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("cx",e.x.toString()),t.setAttribute("cy",e.y.toString()),t.setAttribute("r","15"),t.setAttribute("fill",e.isOpen?"#ff6b6b":"#ff4757"),t.setAttribute("stroke","#ff4757"),t.setAttribute("stroke-width","2");const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",e.x.toString()),n.setAttribute("y",e.y.toString()),n.setAttribute("text-anchor","middle"),n.setAttribute("dominant-baseline","middle"),n.setAttribute("fill","#fff"),n.setAttribute("font-size","12"),n.textContent=e.isOpen?"🟢":"🔴";const o=document.createElementNS("http://www.w3.org/2000/svg","g");return o.appendChild(t),o.appendChild(n),o}return document.createElementNS("http://www.w3.org/2000/svg","g")}function ue(e){const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1",e.start.x.toString()),t.setAttribute("y1",e.start.y.toString()),t.setAttribute("x2",e.end.x.toString()),t.setAttribute("y2",e.end.y.toString()),t.setAttribute("stroke","#00ff88"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-dasharray","5,5");const n=document.createElementNS("http://www.w3.org/2000/svg","text"),o=(e.start.x+e.end.x)/2,i=(e.start.y+e.end.y)/2-10;n.setAttribute("x",o.toString()),n.setAttribute("y",i.toString()),n.setAttribute("text-anchor","middle"),n.setAttribute("fill","#00ff88"),n.setAttribute("font-size","10"),n.textContent=`${e.value} м`;const l=document.createElementNS("http://www.w3.org/2000/svg","g");return l.appendChild(t),l.appendChild(n),l}function de(){ft(),G.value=!1}function ft(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>{var o;const n=(o=t.target.files)==null?void 0:o[0];if(n){const i=new FileReader;i.onload=l=>{var r;try{const a=JSON.parse((r=l.target)==null?void 0:r.result);vt(a),b("success","Проект загружен")}catch{b("error","Ошибка загрузки проекта")}},i.readAsText(n)}},e.click()}function vt(e){e.parameters&&(O.value=e.parameters),e.elements&&(N.value=e.elements),e.obstacles&&(M.value=e.obstacles),e.connections&&(q.value=e.connections),e.measurements&&(X.value=e.measurements),e.layers&&(rt.value=e.layers),e.specification&&(at.value=e.specification),e.calculations&&(I.value=e.calculations),e.calculationTable&&(nt.value=e.calculationTable),H(),Q()}function ce(){setInterval(()=>{const e={name:"Газопровод №1",timestamp:new Date().toISOString(),parameters:O.value,elements:N.value,obstacles:M.value,connections:q.value,measurements:X.value};localStorage.setItem("gaznetcad-autosave",JSON.stringify(e))},5*60*1e3)}function pe(){const e=localStorage.getItem("gaznetcad-autosave");if(e)try{const t=JSON.parse(e),n=new Date(t.timestamp);(new Date().getTime()-n.getTime())/(1e3*60*60)<24&&confirm("Найдено автосохранение. Восстановить?")&&(vt(t),b("info","Проект восстановлен из автосохранения"))}catch{b("warning","Ошибка восстановления автосохранения")}}const G=f(!1);ge(()=>{b("info","GazNetCAD загружен"),Q(),ft(),pe(),ce()});function gt(e,t,n=[]){const o=[e,...n,t],i=[];for(let l=0;l<o.length-1;l++){const r={id:`segment-${Date.now()}-${l}`,start:o[l],end:o[l+1],isWaypoint:l>0&&l<o.length-2,hasCollision:!1};r.hasCollision=M.value.some(a=>et(r.start,r.end,a)),i.push(r)}return i}function lt(e,t=1){return{boxShadow:`0 0 ${10*t}px ${e}, 0 0 ${20*t}px ${e}, 0 0 ${30*t}px ${e}`,textShadow:`0 0 ${5*t}px ${e}`}}function ht(){const e={pipelineElements:N.value,obstacles:M.value,connections:q.value,measurements:X.value,projectParams:O.value,calculationResults:I.value,timestamp:new Date().toISOString()},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`gaznetcad-project-${new Date().toISOString().split("T")[0]}.json`,o.click(),b("success","Проект сохранён"),G.value=!1}return(e,t)=>(p(),c("div",xe,[s("header",we,[t[36]||(t[36]=he('<div class="header-left" data-v-1b342c56><div class="logo" data-v-1b342c56>GazNetCAD</div><div class="project-info" data-v-1b342c56><span class="project-name" data-v-1b342c56>Проект: Газопровод №1</span><span class="project-status" data-v-1b342c56>Активный</span></div></div>',1)),s("div",Se,[s("div",Ce,[s("button",{class:w(["tool-btn",{active:y.value==="select"}]),onClick:t[0]||(t[0]=n=>y.value="select")},t[25]||(t[25]=[s("span",{class:"icon"},"👆",-1),s("span",null,"Выбор",-1)]),2),s("button",{class:w(["tool-btn",{active:y.value==="line"}]),onClick:t[1]||(t[1]=n=>y.value="line")},t[26]||(t[26]=[s("span",{class:"icon"},"📏",-1),s("span",null,"Линия",-1)]),2),s("button",{class:w(["tool-btn",{active:y.value==="pipe"}]),onClick:t[2]||(t[2]=n=>y.value="pipe")},t[27]||(t[27]=[s("span",{class:"icon"},"🔗",-1),s("span",null,"Труба",-1)]),2),s("button",{class:w(["tool-btn",{active:y.value==="valve"}]),onClick:t[3]||(t[3]=n=>y.value="valve")},t[28]||(t[28]=[s("span",{class:"icon"},"🔧",-1),s("span",null,"Клапан",-1)]),2),s("button",{class:w(["tool-btn",{active:y.value==="measure"}]),onClick:t[4]||(t[4]=n=>y.value="measure")},t[29]||(t[29]=[s("span",{class:"icon"},"📐",-1),s("span",null,"Измерение",-1)]),2),s("button",{class:w(["tool-btn",{active:y.value==="obstacle"}]),onClick:t[5]||(t[5]=n=>y.value="obstacle")},t[30]||(t[30]=[s("span",{class:"icon"},"🚧",-1),s("span",null,"Препятствие",-1)]),2)])]),s("div",ke,[s("button",{class:"action-btn",onClick:H},t[31]||(t[31]=[s("span",{class:"icon"},"🔍",-1),s("span",null,"Проверить",-1)])),s("button",{class:"action-btn",onClick:Bt,disabled:F.value.length===0},t[32]||(t[32]=[s("span",{class:"icon"},"🔄",-1),s("span",null,"Обойти",-1)]),8,Ae),s("button",{class:"action-btn",onClick:Q},t[33]||(t[33]=[s("span",{class:"icon"},"⚡",-1),s("span",null,"Расчёт",-1)])),s("button",{class:"action-btn",onClick:ne},t[34]||(t[34]=[s("span",{class:"icon"},"📤",-1),s("span",null,"Экспорт",-1)])),s("button",{class:"action-btn",onClick:ht},t[35]||(t[35]=[s("span",{class:"icon"},"💾",-1),s("span",null,"Сохранить",-1)]))])]),s("div",Me,[s("aside",$e,[s("div",Ee,[t[41]||(t[41]=s("h3",null,"Параметры проекта",-1)),s("div",Re,[t[37]||(t[37]=s("label",null,"Рабочее давление (МПа)",-1)),D(s("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=n=>O.value.pressure=n),step:"0.01",min:"0"},null,512),[[K,O.value.pressure]])]),s("div",Oe,[t[38]||(t[38]=s("label",null,"Температура (°C)",-1)),D(s("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=n=>O.value.temperature=n),step:"1"},null,512),[[K,O.value.temperature]])]),s("div",Ne,[t[40]||(t[40]=s("label",null,"Тип газа",-1)),D(s("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>O.value.gasType=n)},t[39]||(t[39]=[s("option",{value:"natural"},"Природный газ",-1),s("option",{value:"propane"},"Пропан",-1),s("option",{value:"butane"},"Бутан",-1)]),512),[[yt,O.value.gasType]])])]),s("div",Le,[t[48]||(t[48]=s("h3",null,"Свойства элемента",-1)),S.value?(p(),c("div",ze,[s("div",Ve,[t[42]||(t[42]=s("label",null,"Тип",-1)),s("span",null,g(S.value.type),1)]),s("div",Ie,[t[43]||(t[43]=s("label",null,"Длина (м)",-1)),D(s("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=n=>S.value.length=n),step:"0.1"},null,512),[[K,S.value.length]])]),s("div",Pe,[t[44]||(t[44]=s("label",null,"Диаметр (мм)",-1)),D(s("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=n=>S.value.diameter=n),step:"1"},null,512),[[K,S.value.diameter]])]),s("div",Te,[t[46]||(t[46]=s("label",null,"Материал",-1)),D(s("select",{"onUpdate:modelValue":t[11]||(t[11]=n=>S.value.material=n)},t[45]||(t[45]=[s("option",{value:"pe"},"Полиэтилен",-1),s("option",{value:"steel"},"Сталь",-1),s("option",{value:"copper"},"Медь",-1)]),512),[[yt,S.value.material]])]),s("div",De,[t[47]||(t[47]=s("label",null,"Шероховатость (мм)",-1)),D(s("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=n=>S.value.roughness=n),step:"0.01"},null,512),[[K,S.value.roughness]])])])):(p(),c("div",Ue," Выберите элемент на чертеже "))]),s("div",qe,[t[53]||(t[53]=s("h3",null,"Результаты расчёта",-1)),s("div",Fe,[s("div",Ge,[t[49]||(t[49]=s("span",null,"Пропускная способность:",-1)),s("strong",null,g(I.value.flowRate)+" м³/ч",1)]),s("div",Be,[t[50]||(t[50]=s("span",null,"Скорость потока:",-1)),s("strong",null,g(I.value.velocity)+" м/с",1)]),s("div",We,[t[51]||(t[51]=s("span",null,"Потери давления:",-1)),s("strong",null,g(I.value.pressureLoss)+" МПа",1)]),s("div",Xe,[t[52]||(t[52]=s("span",null,"Число Рейнольдса:",-1)),s("strong",null,g(I.value.reynolds),1)])])])]),s("main",Ye,[s("div",je,[s("div",Je,[s("button",{class:w(["view-btn",{active:B.value==="2d"}]),onClick:t[13]||(t[13]=n=>B.value="2d")},"2D",2),s("button",{class:w(["view-btn",{active:B.value==="3d"}]),onClick:t[14]||(t[14]=n=>B.value="3d")},"3D",2),s("button",{class:w(["view-btn",{active:B.value==="isometric"}]),onClick:t[15]||(t[15]=n=>B.value="isometric")},"Изометрия",2)]),s("div",He,[s("button",{onClick:wt},"-"),s("span",null,g(Math.round(R.value*100))+"%",1),s("button",{onClick:xt},"+")])]),s("div",{class:w(["canvas-container",{drawing:y.value==="line",selecting:y.value==="select",measuring:y.value==="measure"}]),onMousedown:Mt,onMousemove:$t,onMouseup:Et},[s("div",{class:"canvas",style:U({transform:`scale(${R.value})`})},[t[55]||(t[55]=s("div",{class:"grid"},null,-1)),s("div",Qe,g(Qt(y.value))+" | X: "+g(W.value.x)+", Y: "+g(W.value.y),1),(p(!0),c(E,null,L(M.value,n=>(p(),c("div",{key:n.id,class:w(["obstacle",[n.type,{"high-priority":n.priority==="high"}]]),style:U(Wt(n))},[s("div",Ke,g(n.name),1)],6))),128)),(p(!0),c(E,null,L(_.value,n=>(p(),c("div",{key:n.id,class:"reroute-path",style:U(Xt(n))},t[54]||(t[54]=[s("div",{class:"reroute-label"},"Обход",-1)]),4))),128)),z.value?(p(),c("div",{key:0,class:"drawing-line",style:U(Yt(z.value))},null,4)):T("",!0),(p(!0),c(E,null,L(q.value,n=>(p(),c(E,null,[(p(!0),c(E,null,L(n.segments,(o,i)=>(p(),c("div",{key:i,class:w(["connection-segment",{final:i===n.segments.length-1,collision:n.hasCollision}]),style:U(jt(o))},null,6))),128))],64))),256)),(p(!0),c(E,null,L(N.value,n=>(p(),c("div",{key:n.id,class:w(["pipeline-element",[n.type,{selected:S.value&&S.value.id===n.id}]]),style:U(Jt(n)),onMousedown:bt(o=>Ct(n),["stop"])},[n.type==="pipe"?(p(),c("div",_e,g(n.name),1)):n.type==="valve"?(p(),c("div",{key:1,class:w(["valve",{closed:!n.isOpen}]),onClick:bt(o=>kt(n),["stop"])},g(n.isOpen?"🟢":"🔴"),11,tn)):T("",!0)],46,Ze))),128)),(p(!0),c(E,null,L(X.value,n=>(p(),c("div",{key:n.id,class:"measurement",style:U(Ht(n))},[s("div",en,g(n.value)+" м",1)],4))),128))],4)],34)]),s("aside",nn,[s("div",sn,[s("button",{class:w(["tab",{active:A.value==="console"}]),onClick:t[16]||(t[16]=n=>A.value="console")},"Консоль",2),s("button",{class:w(["tab",{active:A.value==="spec"}]),onClick:t[17]||(t[17]=n=>A.value="spec")},"Спецификация",2),s("button",{class:w(["tab",{active:A.value==="calc"}]),onClick:t[18]||(t[18]=n=>A.value="calc")},"Таблица расчёта",2),s("button",{class:w(["tab",{active:A.value==="layers"}]),onClick:t[19]||(t[19]=n=>A.value="layers")},"Слои",2)]),A.value==="console"?(p(),c("div",on,[s("div",ln,[(p(!0),c(E,null,L(j.value,n=>(p(),c("div",{key:n.id,class:w(["log-item",n.type])},[s("span",rn,g(n.time),1),ye(" "+g(n.message),1)],2))),128))])])):T("",!0),A.value==="spec"?(p(),c("div",an,[s("div",un,[s("table",null,[t[56]||(t[56]=s("thead",null,[s("tr",null,[s("th",null,"Поз."),s("th",null,"Наименование"),s("th",null,"Кол-во"),s("th",null,"Ед.")])],-1)),s("tbody",null,[(p(!0),c(E,null,L(at.value,n=>(p(),c("tr",{key:n.id},[s("td",null,g(n.position),1),s("td",null,g(n.name),1),s("td",null,g(n.quantity),1),s("td",null,g(n.unit),1)]))),128))])])])])):T("",!0),A.value==="calc"?(p(),c("div",dn,[s("div",cn,[s("table",null,[t[57]||(t[57]=s("thead",null,[s("tr",null,[s("th",null,"Участок"),s("th",null,"Длина (м)"),s("th",null,"Диаметр (мм)"),s("th",null,"Q (м³/ч)"),s("th",null,"Потери (МПа)")])],-1)),s("tbody",null,[(p(!0),c(E,null,L(nt.value,n=>(p(),c("tr",{key:n.id},[s("td",null,g(n.name),1),s("td",null,g(n.length),1),s("td",null,g(n.diameter),1),s("td",null,g(n.flowRate),1),s("td",null,g(n.pressureLoss),1)]))),128))])])])])):T("",!0),A.value==="layers"?(p(),c("div",pn,[s("div",fn,[s("table",null,[t[58]||(t[58]=s("thead",null,[s("tr",null,[s("th",null,"Слой"),s("th",null,"Видимость"),s("th",null,"Цвет")])],-1)),s("tbody",null,[(p(!0),c(E,null,L(rt.value,n=>(p(),c("tr",{key:n.id},[s("td",null,g(n.name),1),s("td",null,[D(s("input",{type:"checkbox","onUpdate:modelValue":o=>n.visible=o},null,8,vn),[[be,n.visible]])]),s("td",null,[s("span",{style:U({color:n.color})},"●",4)])]))),128))])])])])):T("",!0)])]),tt.value?(p(),c("div",gn,[s("div",hn,[t[59]||(t[59]=s("h3",null,"Выберите тип препятствия",-1)),s("div",yn,[s("div",bn,[s("button",{class:"obstacle-type-btn",onClick:t[20]||(t[20]=n=>it("building"))},"Здание"),s("button",{class:"obstacle-type-btn",onClick:t[21]||(t[21]=n=>it("tree"))},"Дерево"),s("button",{class:"obstacle-type-btn",onClick:t[22]||(t[22]=n=>it("underground"))},"Подземная труба")])]),s("button",{class:"modal-close-btn",onClick:t[23]||(t[23]=n=>tt.value=!1)},"Отмена")])])):T("",!0),G.value?(p(),c("div",mn,[s("div",xn,[t[64]||(t[64]=s("h3",null,"Экспорт проекта",-1)),s("div",{class:"modal-content"},[s("div",{class:"export-options"},[s("button",{class:"export-btn",onClick:ht},t[60]||(t[60]=[s("span",{class:"export-icon"},"💾",-1),s("span",null,"Сохранить проект (JSON)",-1)])),s("button",{class:"export-btn",onClick:se},t[61]||(t[61]=[s("span",{class:"export-icon"},"📐",-1),s("span",null,"Экспорт схемы (SVG)",-1)])),s("button",{class:"export-btn",onClick:oe},t[62]||(t[62]=[s("span",{class:"export-icon"},"🖼️",-1),s("span",null,"Экспорт изображения (PNG)",-1)])),s("button",{class:"export-btn",onClick:de},t[63]||(t[63]=[s("span",{class:"export-icon"},"📂",-1),s("span",null,"Импорт проекта",-1)]))])]),s("button",{class:"modal-close-btn",onClick:t[24]||(t[24]=n=>G.value=!1)},"Закрыть")])])):T("",!0)]))}}),Mn=me(wn,[["__scopeId","data-v-1b342c56"]]);export{Mn as default};
